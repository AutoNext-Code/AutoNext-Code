@if (isLoaded) {

  <div class="lg:flex lg:justify-center w-full overflow-x-auto">
    <svg #svgElement width="800" height="600" viewBox="0 0 800 600" class="w-[800px] block">
      <image
        [attr.href]="imageUrl"
        width="800"
        height="600"
      />

      @for (space of spaces; track $index) {

        @if(spaceTaken(space) && !adminView){
          <g class="tooltip-space" [attr.transform]="'translate(' + ((space.x) - 23) + ',' + (space.y - 25) + ')'">

            <g
              [attr.transform]="'rotate(' + space.direction + ', 17, 22)'"

            >
              <use
                xlink:href= "./assets/svg/CarIcon.svg#custom-marker"
                width="35" height="44"
                [attr.filter]="space.state">
              </use>


            </g>


            <g class="tooltip-group">
              <rect
                class="tooltip-bg"

              ></rect>

              <text
                class="tooltip-text"
                x="15"
                y="-18"
              >
              {{getTooltipText(space)}}
              </text>

            </g>


          </g>




        }@else {

          @if(statusSpace(space)){

            <g
            [attr.transform]="'translate(' + ((space.x) - 23) + ',' + (space.y - 25) + ') rotate(' + space.direction + ', 17, 22)'"
            (click)="toggleModal(space.id, space.plugType.toString())"
            class="cursor-pointer"
            >
            <use
              xlink:href= "./assets/svg/CarIcon.svg#custom-marker"
              width="35" height="44"
              [attr.filter]="space.state">
            </use>
          </g>



          }@else if(adminView){

            <g
            [attr.transform]="'translate(' + ((space.x) - 23) + ',' + (space.y - 25) + ') rotate(' + space.direction + ', 17, 22)'"
            (click)="toggleAdmin(space)"
            class="cursor-pointer"
            >
            <use
              xlink:href= "./assets/svg/CarIcon.svg#custom-marker"
              width="35" height="44"
              [attr.filter]="space.state">
            </use>
          </g>



          }@else {
            <g
            [attr.transform]="'translate(' + ((space.x) - 23) + ',' + (space.y - 25) + ') rotate(' + space.direction + ', 17, 22)'"


          >
            <use
              xlink:href= "./assets/svg/CarIcon.svg#custom-marker"
              width="35" height="44"
              [attr.filter]="unusable">
            </use>
          </g>
          }

        }

      }
    </svg>
  </div>

}

<ng-container *ngIf="!modal && carData">
  <div
    class="fixed z-10 overflow-y-auto top-0 w-full left-0 max-sm:my-30"
    id="modal"
  >
    <space-data
      (modalEmitter)="closeModal()"
      (reservationMade)="closeModal()"
      [spaceData]="carData"
      [canBook]="canBook"
    >
    </space-data>
  </div>
</ng-container>

<ng-container *ngIf="adminModal">
  <div
    class="fixed z-10 overflow-y-auto top-0 w-full left-0 max-sm:my-30"
    id="modal"
  >

  <ng-template #content>
    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4 flex justify-center" >

      <booking-list 
        [bookingList]="bookingList"
        (pageChanger)="loadPastBookings($event)"
      />

    </div>
  
  </ng-template>
  
  
  <ng-template #buttons>
    <div class="bg-gray-200 px-4 py-3 grid grid-cols-3 z-99">
      <app-custom-button
        color="gray"
        icon="close"
        label="Cancelar"
        class="m-4 rounded"
        (onClick)="closeAdmin()">
      </app-custom-button>
      <app-custom-button
        color="red"
        icon="shield"
        label="Bloquear"
        class="m-4 rounded">
      </app-custom-button>
      <app-custom-button
        color="green"
        icon="edit"
        label="Editar"
        class="m-4 rounded"
        (onClick)="toggleEdit()">
      </app-custom-button>
    </div>
  </ng-template>
  
  <shared-custom-modal
    [title]="'ConfiguraciÃ³n De Plaza - '+ spaceEditedId"
    [container]="content"
    [buttons]="buttons"
    [visible]="true"
    class="z-0"
  ></shared-custom-modal>

  </div>
</ng-container>

<ng-container *ngIf="adminModal && edit">
  <div
    class="fixed z-10 overflow-y-auto top-0 w-full left-0 max-sm:my-30"
    id="modal"
  >

  <ng-template #content>
    <div class="flex flex-col space-y-6 p-5">
      <label class="block">
        <span class="block text-sm font-medium mb-1 text-gray-500">Puesto:</span>
        <select value="0" [(ngModel)]="editPlugType"
            class="w-[300px] h-11 border border-gray-400 text-gray-700 rounded px-4 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-mydarkblue"
        >
            <option value="0">NoType</option>
            <option value="1">Undefined</option>
            <option value="2">Schuko</option>
            <option value="3">Type1</option>
            <option value="4">Type2</option>
            <option value="5">CCS</option>
            <option value="6">CHAdeMO</option>
          </select>
          
    </label>
      <label class="block">
        <span class="block text-sm font-medium mb-1 text-gray-500">Puesto:</span>
        <select value="0" [(ngModel)]="jobPosition"
            class="w-[300px] h-11 border border-gray-400 text-gray-700 rounded px-4 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-mydarkblue"
        >
            <option value="0">Sin puesto</option>
            <option value="1">Intern</option>
            <option value="2">Product Owner</option>
            <option value="3">Scrum Master</option>
            <option value="4">Developer</option>
            <option value="5">PEM</option>
            <option value="6">Branch Head</option>
          </select>
          
    </label>

    </div>
  
  </ng-template>
  
  
  <ng-template #buttons>
    <div class="bg-gray-200 px-4 py-3 grid grid-cols-3 z-99">
      <app-custom-button
        color="gray"
        icon="close"
        label="Cancelar"
        class="m-4 rounded"
        (onClick)="closeAdmin()">
      </app-custom-button>
      <div></div>
      <app-custom-button
        color="dark-blue"
        icon="book"
        label="Guardar"
        class="m-4 rounded"
        (click)="updateSpace(spaceEditedId, jobPosition)">
      </app-custom-button>
    </div>
  </ng-template>
  
  <shared-custom-modal
    [title]="'Editar Plaza - '+ spaceEditedId"
    [container]="content"
    [buttons]="buttons"
    [visible]="true"
    class="z-99"
  ></shared-custom-modal>

  </div>
</ng-container>
